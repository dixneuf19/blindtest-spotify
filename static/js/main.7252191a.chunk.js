(this["webpackJsonpblindtest-spotify"]=this["webpackJsonpblindtest-spotify"]||[]).push([[0],{23:function(e,t,n){e.exports=n.p+"static/media/logo.79f6b6a0.svg"},24:function(e,t,n){e.exports=n.p+"static/media/loading.9d4cbf40.svg"},25:function(e,t,n){e.exports=n(55)},30:function(e,t,n){},32:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(22),c=n.n(s),o=(n(30),n(1)),i=n.n(o),u=n(2),l=n(7),h=n(8),m=n(10),f=n(9),p=n(11),d=n(23),k=n.n(d),v=n(24),b=n.n(v),g=(n(32),n(13)),w=n.n(g),y=(n(54),function(e){return r.a.createElement("button",{onClick:e.onClick},e.children)}),E="BQBdilD6dG9JGmNA3ocebjEM_cqlP8fYU4j528o3HbZk_NXq5hw7IbW6mn_yBxXU-A3jdZW2YOvZ6AjxXnZBPTOcMkhpg5FHTCNX6t9NsAmMwJz3Y4SopoJj5dCAwxXtx75TCSO-t8bK0Xnu69NWzEJ0",T="https://api.spotify.com/v1/me/tracks";function x(e){return Math.floor(Math.random()*e)}var j=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return this.props.track?r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("b",null,this.props.track.name)," by ",r.a.createElement("b",null,this.props.track.artists[0].name)),r.a.createElement("div",null,this.props.sound?r.a.createElement(w.a,{url:this.props.track.preview_url,playStatus:w.a.status.PLAYING}):r.a.createElement("div",null)),r.a.createElement("div",null,r.a.createElement(O,{images:this.props.track.album.images}))):r.a.createElement("div",null,r.a.createElement("b",null,"No song fetch"))}}]),t}(a.Component),O=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.images[0].url;return r.a.createElement("img",{src:e,style:{width:400,height:400}})}}]),t}(a.Component),S=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(m.a)(this,Object(f.a)(t).call(this))).state={text:"",libraryFetched:!1,songsLoaded:!1,currentTrack:{},tracks:[],timeout:{},apiToken:E,invalidToken:!1,error:""},e}return Object(p.a)(t,e),Object(h.a)(t,[{key:"checkAnswer",value:function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.state.currentTrack.id){e.next=8;break}return clearTimeout(this.state.timeout),e.next=4,swal("Bravo","It was ".concat(this.state.currentTrack.name," by ").concat(this.state.currentTrack.artists[0].name),"succes");case 4:return e.next=6,this.resetGame();case 6:e.next=9;break;case 8:swal("Nope.","It was ".concat(this.state.currentTrack.name," by ").concat(this.state.currentTrack.artists[0].name),"warning");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchOneSong",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(T,"?limit=1&offset=").concat(t),{method:"GET",headers:{Authorization:"Bearer "+this.state.apiToken}}).then((function(e){return e.json()}));case 2:if(!(n=e.sent).items){e.next=7;break}return e.abrupt("return",n.items[0].track);case 7:throw new Error(n.error?"error ".concat(n.error.status,": ").concat(n.error.message):"unknown error");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchNewSongs",value:function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(T,{method:"GET",headers:{Authorization:"Bearer "+this.state.apiToken}}).then((function(e){return e.json()}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getShuffledTracks",value:function(e,t){return function(e){for(var t=e.length;t>0;){var n=x(t),a=e[--t];e[t]=e[n],e[n]=a}return e}(e.items.map((function(e){return e.track}))).filter((function(e,n){return n<t}))}},{key:"timeout",value:function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,swal("Too long !","It was ".concat(this.state.currentTrack.name," by ").concat(this.state.currentTrack.artists[0].name),"warning");case 2:this.resetGame();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetGame",value:function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({songsLoaded:!1}),e.prev=1,e.next=4,this.setRandomTracksFromAll(this.state.res.total);case 4:this.setState({invalidToken:!1}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),this.setState({invalidToken:!0,error:e.t0.message});case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"setNewRandomTracks",value:function(){var e=this,t=this.getShuffledTracks(this.state.res,3);this.setState({currentTrack:t[x(3)],tracks:t,timeout:setTimeout((function(){return e.resetGame(e.state)}),3e4)})}},{key:"setRandomTracksFromAll",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var n,a,r,s=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Fetching new tracks"),n=[],a=0;case 3:if(!(a<3)){e.next=14;break}r=void 0;case 5:return e.next=7,this.fetchOneSong(x(t));case 7:r=e.sent;case 8:if(!r.preview_url){e.next=5;break}case 9:n.push(r),console.log("Got track ".concat(a+1," out of ").concat(3));case 11:a++,e.next=3;break;case 14:this.setState({currentTrack:n[x(3)],tracks:n,timeout:setTimeout((function(){return s.resetGame(s.state)}),3e4),songsLoaded:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({apiToken:e.target.api_token.value,libraryFetched:!1,songsLoaded:!1}),this.componentDidMount()}},{key:"componentDidMount",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchNewSongs();case 2:if(!(t=e.sent).error||401!==t.error.status){e.next=7;break}this.setState({invalidToken:!0}),e.next=11;break;case 7:return this.setState({invalidToken:!1,res:t,libraryFetched:!0,text:"Your library has ".concat(t.total," songs !")}),e.next=10,this.resetGame();case 10:console.log(this.state);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=r.a.createElement("form",{onSubmit:function(t){return e.handleSubmit(t)},id:"token_form"},r.a.createElement("span",null,r.a.createElement("a",{href:"https://developer.spotify.com/console/get-current-user-saved-tracks/"},"Spotify API token")," : "),r.a.createElement("input",{type:"text",id:"api_token",name:"api_token",placeholder:this.state.apiToken}),r.a.createElement("button",{type:"submit",value:"Submit"},"OK")),n=r.a.createElement("div",{className:"App-images"},r.a.createElement("div",null,r.a.createElement("p",null,this.state.text),r.a.createElement(y,{onClick:function(){return e.resetGame()}},"New songs"))),a=r.a.createElement("img",{src:b.a,className:"App-loading",alt:"loading"}),s=r.a.createElement("div",{className:"App-buttons"},this.state.tracks.map((function(t,n){return r.a.createElement(y,{onClick:function(){return e.checkAnswer(t.id)},key:n},r.a.createElement(j,{track:t,sound:t.id===e.state.currentTrack.id}))})));r.a.createElement("div",null,n,s);return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:k.a,className:"App-logo",alt:"logo"}),r.a.createElement("h1",{className:"App-title"},"Bienvenue sur le Blindtest")),r.a.createElement("main",null,t,this.state.invalidToken?r.a.createElement("div",null,r.a.createElement("h3",null,"Invalid Spotify API Token"),r.a.createElement("p",null,this.state.error)):this.state.libraryFetched?r.a.createElement("div",null,r.a.createElement("div",null,n),r.a.createElement("div",null,this.state.songsLoaded?s:a)):a,r.a.createElement("div",null,r.a.createElement("p",null,"Hi this is a blind test from the music of ",r.a.createElement("b",null,"your Spotify")," music Library. Get a Spotify API Token from the link, and paste it above."))))}}]),t}(a.Component),A=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function N(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(S,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/blindtest-spotify",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/blindtest-spotify","/service-worker.js");A?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):N(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):N(e)}))}}()}},[[25,1,2]]]);
//# sourceMappingURL=main.7252191a.chunk.js.map